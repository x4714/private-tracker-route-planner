<!DOCTYPE html>
<html lang="en">
<head>
  <script src="data.json"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TrackersInfo Official Recruitments</title>
  <style>

    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      overflow-y: auto;
      font-family: 'Google Sans', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    #routeContainer {
      flex: 1;
      width: 100%;
      position: relative;
      overflow-y: auto;
    }

    #calcForm {
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      box-sizing: border-box;
    }

    #headerTable {
      width: 60%;
      max-width: 800px;
      margin-left: 0;
      margin-right: auto;
      margin-bottom: 20px;
      border-collapse: collapse;
    }

    .col2 {
      text-align: left;
      position: relative;
    }

    #target, #source {
      font-size: 14px;
      font-family: inherit;
      cursor: pointer;
      overflow: hidden;
      color: #888;
      background: transparent;
      padding: 8px 16px;
      transition: all 0.2s ease;
    }

    #target:hover, #source:hover {
      background: #f1f3f4;
    }

    .trackerButton {
      position: absolute;
      top: 0%;
      left: 0%;
      width: 60%;
      height: 80%;
      display: flex;
      z-index: 900;
      word-break: break-all;
	  border: 1px solid #888;
    }

    .trackerButton:hover {
      background: #f1f3f4;
    }

    #sourceAbbr, #targetAbbr {
      position: absolute;
      width: 100%;
      font-size: 14px;
      color: #5f6368;
      bottom: 0;
	  display: none;
    }

    #gridContainer {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      z-index: 1000;
      display: none;
      max-height: 80vh;
      overflow-y: auto;
      scrollbar-width: none;
      -ms-overflow-style: none; 
    }

    #gridContainer::-webkit-scrollbar {
      display: none;
    }

    .grid-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 10px;
      padding-top: 40px;
    }

    .filter-input {
      width: calc(90vw - 40px);
      max-width: 920px;
      padding: 12px 16px;
      margin: 0;
      border: 1px solid #dadce0;
      border-radius: var(--border-radius);
      background: white;
      z-index: 10001;
      box-shadow: var(--box-shadow);
      font-size: 16px;
      transition: all 0.2s ease;
    }

    .filter-input:focus {
      border-color: var(--primary-color);
      outline: none;
      box-shadow: 0 0 0 2px rgba(26,115,232,0.1);
    }

    .grid-item {
      padding: 12px;
      background: white;
      color: var(--text-color);
      border: 1px solid #dadce0;
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
    }

    .grid-item:hover {
      background: #f1f3f4;
      border-color: var(--primary-color);
    }

    #detailsTable {
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
      box-sizing: border-box;
    }

    .block.route {
      width: 100%;
      margin-bottom: 10px;
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
    }

    .route-header {
      padding: 8px 12px; 
      background-color: #d2efff; 
      border-bottom: 1px solid #ddd;
      transition: background-color 0.2s ease;
      display: flex; 
      align-items: center; 
      gap: 10px; 
      font-size: 13px; 
    }

    .route-header:hover {
      background-color: #e0e0e0;
    }

    .route-header.active {
      background-color: #d2efff;  
    }
    
    .route-number-label {
      background-color: #f5a623; 
      color: white;
      padding: 4px 8px; 
       
      border-radius: 0; 
      font-weight: 500; 
      white-space: nowrap;
      flex-shrink: 0;
      font-size: 13px; 
    }

    
    .route-time-display,
    .route-changes-display {
      display: inline-flex; 
      align-items: center;
      gap: 5px;
      font-size: 13px; 
      color: #333;
    }

    
    .route-time-display {
      margin-left: 40%; 
    }

    
    .route-label {
      color: white;
      padding: 3px 6px; 
      font-size: 13px; 
    }

    
    .time-label {
      background-color: #d9534f; 
      color: white; 
    }

    .changes-label {
      background-color: #5f4b8b; 
      color: white;
    }

    
    .route_header::after {
      display: none;
    }

    .table-container {
      margin: 0;
      padding: 0;
      background: white;
    }

    #routeTable {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }

    #routeTable tr {
      border-bottom: 1px solid #dadce0;
    }

    #routeTable tr:last-child {
      border-bottom: none;
    }

    #routeTable td {
      padding: 16px;
      vertical-align: top;
    }

    #routeTable .route-header {
      background: #d2efff;
      font-weight: 500;
      color: var(--text-color);
    }

    #routeTable .route-time {
      color: var(--primary-color);
      font-weight: 500;
      white-space: nowrap;
    }

    #routeTable .route-info {
      color: #5f6368;
      font-size: 14px;
    }

    #routeTable .route-requirements {
      background: #f8f9fa;
      padding: 12px;
      border-radius: var(--border-radius);
      margin-top: 8px;
    }

    #routeTable .route-activity {
      color: #5f6368;
      font-size: 13px;
      margin-top: 8px;
    }

    #chainInfo {
      margin: 16px auto 0;
      width: 100%;
      max-width: 1080px;
      background: white;
      padding: 16px;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      font-size: 14px;
      color: var(--text-color);
    }

    #chainInfo td {
      padding: 8px 16px;
    }

    #chainInfo .route-number {
      color: var(--primary-color);
      font-weight: 500;
    }

    #chainInfo .route-summary {
      color: #5f6368;
    }

    
    #routeChain {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 12px;
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      margin: 0 auto;
      max-width: 1080px;
    }

    .route-step {
      display: flex;
      align-items: center;
      margin: 0 8px;
      color: var(--text-color);
      font-weight: 500;
    }

    .route-step:not(:last-child)::after {
      content: "→";
      margin-left: 8px;
      color: #5f6368;
    }

    
    #update-time {
      position: fixed;
      bottom: 0.5em;
      right: 0.5em;
      background: rgba(255, 255, 255, 0.8);
      padding: 5px;
      z-index: 1000;
    }

    a {
      color: var(--primary-color);
      text-decoration: none;
      transition: all 0.2s ease;
    }

    a:hover {
      text-decoration: underline;
      color: var(--secondary-color);
    }

    
    @media (max-width: 720px) {
      #headerTable {
        height: auto;
      }
      
      .grid-container {
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      }
      
      #gridContainer {
        width: 95vw;
      }
      
      #detailsTable {
        font-size: 12px;
      }
      
      #routeTable td {
        padding: 12px;
      }
      
      .route-step {
        font-size: 14px;
      }
      
      #chainInfo {
        padding: 12px;
      }
    }

    @media (max-width: 1600px) {
      #calcForm {
        padding: 15px;
      }
    }

    .route-timeline {
      position: relative;
      padding: 20px;
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
    }

    .route-summary {
      padding: 8px 12px;
      margin-bottom: 16px;
      background: #f8f9fa;
      border-radius: 4px;
    }

    .route-number {
      background: #ff9500;
      color: white;
      padding: 4px 8px;
      border-radius: 3px;
      margin-right: 12px;
      font-size: 13px;
    }

    .route-time {
      font-size: 14px;
      margin-right: 16px;
    }

    .route-info-tag {
      padding: 2px 6px;
      font-size: 11px;
    }

    .timeline-container {
      position: relative;
      padding-left: 40px;
      margin: 20px 0;
    }

    .timeline-line {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      width: 3px;
      background-color: #009BBF;
      z-index: 1;
    }

    .timeline-line.top {
      top: 0;
      height: 50%;
    }

    .timeline-line.bottom {
      bottom: 0;
      height: 50%;
    }

    .station-point {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: white;
      border: 2px solid #009bbf;
      z-index: 1;
    }

    .station-container {
      position: relative;
      padding: 12px 0;
      margin-bottom: 12px;
      min-height: 40px;
    }

    .station-time {
      position: absolute;
      left: -35px;
      top: 50%;
      transform: translateY(-50%);
      color: #1a73e8;
      font-weight: 500;
      font-size: 14px;
      white-space: nowrap;
    }

    .station-name {
      margin-left: 30px;
      font-size: 14px;
      margin-bottom: 2px;
      font-weight: 500;
    }

    .station-name-sub {
      margin-left: 30px;
      font-size: 12px;
      color: #5f6368;
    }

    .route-segment {
      padding: 8px 0;
      margin-left: 30px;
      position: relative;
    }

    .ticket-info {
      background: #f8f9fa;
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 13px;
      color: #5f6368;
      margin: 8px 0;
    }

    
    .station-buttons {
      display: none;
    }




    
    .block.route:hover::before,
    .block.route:hover::after {
      display: none;
    }

    
    .route_header::after {
      display: none;
    }

    
    #detailsTable::-webkit-scrollbar-button {
      display: none;
    }

    .route_header {
      padding: 12px;
      background: #d2efff;
      border-bottom: 1px solid #333;
    }

    .route_header .tbl {
      display: table;
      width: 100%;
    }

    .route_header .col {
      display: table-cell;
      vertical-align: middle;
    }

    .route_header .col.number {
      width: 80px;
      text-align: center;
    }

    .route_header .col.number .label {
      background: #ff9500;
      color: white;
      padding: 4px 8px;
      border-radius: 3px;
      display: inline-block;
    }

    .route_header .col.number .label p {
      margin: 0;
      line-height: 1.2;
    }

    .route_header .col.wrapper {
      padding: 0 12px;
    }

    .summary_1 .time {
      font-size: 16px;
      font-weight: 500;
      margin-bottom: 4px;
    }

    .summary_2 {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .hyouka .label {
      background: #e8f5e9;
      color: #2e7d32;
      padding: 2px 8px;
      border-radius: 3px;
      font-size: 12px;
    }

    .tf {
      display: flex;
      gap: 16px;
      color: #5f6368;
      font-size: 13px;
    }

    .tf .label {
      color: #5f6368;
      margin-right: 4px;
    }

    .block_content.collapsed .dtl .row {
      display: none;
    }

    .block_content.collapsed .dtl .row.sta.from,
    .block_content.collapsed .dtl .row.sta.to {
      display: flex;
    }

    .dtl .row {
      position: relative;
      min-height: 48px;
      display: flex;
    }

    .dtl .row .tbl {
      display: table;
      width: 95%;
    }

    .dtl .col.border {
      display: table-cell;
      width: 10px;
      position: relative;
	  border-right: 4px solid #009BBF;
    }

    .border_top {
      position: absolute;
      top: 0;
      left: 50%;
      width: 4px;
      height: 50%;
      transform: translateX(-50%);
    }

    .mark {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: white;
      border: 2px solid #009bbf;
      z-index: 1;
    }

    .col.wrapper {
      display: table-cell;
      padding: 12px 16px;
      vertical-align: middle;
    }

    .col.header {
      width: 100%;
    }

    .col.header .time {
      color: #1a73e8;
      font-weight: 500;
    }

    .name .lang_main {
      font-size: 16px;
      margin-bottom: 2px;
	  margin-top: 2px;
	  margin-left: 20px;
	  font-family: 'Noto Sans SC';
	  font-weight: bold;
    }

    .name .lang_sub {
      font-size: 12px;
      color: #5f6368;
    }


    .row.line .fare {
      font-size: 13px;
      color: #5f6368;
      margin-bottom: 8px;
    }

    .row.trans {
      background: #f8f9fa;
    }

    .trans_p {
      margin: 0;
    }

    .icn_tra {
      width: 16px;
      height: 16px;
      vertical-align: middle;
      margin-right: 8px;
    }

    .arrow-indicator {
      position: fixed;
      pointer-events: none;
      color: #009BBF;
      font-size: 14px;
      line-height: 1.2;
      text-align: center;
      z-index: 1000;
      animation: arrowBlink 1s infinite;
      display: none;
    }

    @keyframes arrowBlink {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 1; }
    }

    
    .row.sta, .row.line {
      width: 100%;
      box-sizing: border-box;
    }

    
    .inline-settings-container {
       
      flex-wrap: wrap; 
      gap: 15px; 
      background-color: #f8f9fa; 
      border: 1px solid #e9ecef;
      
      margin-top: 20px; 
      margin-bottom: 20px; 
      max-width: 800px; 
      margin-left: auto;
      margin-right: auto;
    }

    .settings-section {
      flex: 1; 
      min-width: 250px; 
      display: flex;
      flex-direction: column;
      width: 100%; 
      margin-bottom: 15px; 
      box-sizing: border-box; 
    }
    .settings-section:last-child { 
      margin-bottom: 0;
    }

    .settings-header {
      background-color: #ff9500; 
      color: white;
      padding: 6px 10px;
      font-size: 14px;
      font-weight: 500;
      
    }

    .settings-options {
      background-color: white;
      padding: 10px;
       
      
      
      flex-grow: 1;
      display: flex; 
      flex-wrap: wrap; 
      gap: 15px 25px; 
      align-items: flex-start; 
    }

    .settings-option-item {
       
       
       
      margin-bottom: 0; 
      gap: 10px; 
      flex: 1 1 auto; 
      min-width: 140px; 
      display: flex; 
      flex-direction: column; 
    }

    .settings-option-item:last-child {
      margin-bottom: 0;
    }

    .settings-option-item label:first-child { 
      font-weight: 500;
      display: block;
    }

    .radio-options {
      display: flex;
      flex-wrap: wrap; 
      gap: 5px 15px; 
    }

    .radio-option {
      display: flex;
      align-items: center;
      gap: 4px; 
      font-size: 13px;
      cursor: pointer;
       
    }
    .radio-option input[type="radio"] {
      margin: 0;
      cursor: pointer;
    }

    
    .settings-option-item input[type="number"],
    .settings-option-item select {
      display: none; 
    }

    
    .station-selector-container,
    .input-group,
    .station-label,
     
    .input-icon-btn,
    .swap-btn,
    .inline-settings-container,
    .settings-section,
    .settings-header,
    .settings-options,
    .block.route,
    .route-summary,
    .route-number,
    .tag,
    .tag-complex,
    .tag-complex .tag-label,
    .tag-complex .tag-value,
    .timeline-marker,
    .pagination,
    .page-btn,
    #gridContainer, 

    .grid-item, 
    .filter-input 
     {
      border-radius: 0 !important; 
    }

    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 10px;
      background-color: #f8f9fa;
      border-top: 1px solid #dee2e6;
    }

    .page-btn {
      background-color: #fff;
      border: 1px solid #dee2e6;
      color: #495057;
      padding: 8px 12px;
      margin: 0 5px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    .page-btn:hover {
      background-color: #e9ecef;
    }

    .page-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }



    
    .current-selection-display {
      display: none; 
    }

    
    .station-selector-container {
      display: none; 
    }

    
    .input-station-wrapper {
      display: flex;
      flex-direction: column; 
    }

    
    input.station-input {
      padding: 8px 10px;
      border: 1px solid #ccc;
       
      font-size: 14px;
       
      box-sizing: border-box;
    }

    
    .station-abbr {
      font-size: 12px;
      color: #666;
      text-align: left; 
      margin-top: 3px;
      min-height: 1em; 
    }

    
    #headerTable td.col2,
    #headerTable td.col4 {
      padding: 5px; 
      vertical-align: top; 
    }

    
    input.station-input::-webkit-calendar-picker-indicator {
      display: none;
    }

    
    .time-label {
      background-color: #d9534f; 
      color: white; 
    }

    .changes-label {
      background-color: #5f4b8b; 
      color: white; 
    }

    
    .route-label {
      
      color: white; 
      padding: 2px 8px;
      font-size: 11px;
    }

    
    .dtl {
      border: 1px solid #ccc;
      background-color: #f8f9fa; 
      padding: 0;
    }

    
    .dtl .row {
      position: relative;
    }

    .dtl .tbl {
      display: table;
      width: 100%;
      table-layout: fixed; 
    }

    .dtl .col {
      display: flex;
      vertical-align: top; 
      padding: 5px;
    }

    
    .dtl .col.border {
      width: 10px; 
      position: relative; 
      padding: 0;
      vertical-align: middle; 
    }

    .dtl .border_top {
      height: 10px; 
      width: 3px; 
      margin: 0 auto; 
      background: transparent; 
    }

    .dtl .mark {
      position: relative; 
      width: 30px;
      height: 30px;
      margin: 5px auto; 
      border-radius: 50%;
      background-color: white;
      border: 3px solid #F62E36; 
      display: flex;
      align-items: center;
      justify-content: center;
      box-sizing: border-box;
      z-index: 2; 
    }
    .dtl .mark.line-mark {
       background-color: #007bff; 
       border: 3px solid #007bff; 
       color: white;
       width: 24px; 
       height: 24px;
       margin: 15px auto; 
    }

    .dtl .mark .inner {
      text-align: center;
    }
    .dtl .mark .inner .icn_sta_alt { 
      font-size: 11px;
      font-weight: bold;
      color: #F62E36; 
    }
    .dtl .mark.line-mark .inner .btn { 
        font-size: 12px;
        font-weight: bold;
        color: white;
    }


    
    .dtl .col.border::before {
      content: '';
      position: absolute;
      top: 0;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 3px; 
      background-color: inherit; 
      z-index: 1; 
    }
    .dtl .row.sta.from .col.border::before { top: 50%; } 
    .dtl .row.sta.to .col.border::before { bottom: 50%; } 


    
    .dtl .col.wrapper {
      width: auto; 
      padding-left: 10px;
    }

    
    .dtl .col.header .time {
      font-size: 16px;
      color: #007bff; 
      margin-bottom: 0;
    }


    .dtl .col.content .name {
      margin-bottom: 5px;
    }
    .dtl .col.content .lang_main {
      font-weight: bold;
      font-size: 14px;
      margin-bottom: 2px;
    }
    .dtl .col.content .lang_sub {
      font-size: 12px;
      color: #5f6368; 
    }

    .dtl .col.aside {
      width: 80px; 
      text-align: right;
      vertical-align: middle;
      font-size: 13px;
      color: #5f6368;
    }
    .dtl .row.line .col.aside { 
       font-weight: bold;
    }


    .dtl .col.link {
      width: 60px; 
      text-align: right;
      vertical-align: middle;
    }


    
    .dtl .row.line .fare {
      border: 1px solid #5f4b8b; 
      border-radius: 15px; 
      padding: 5px 15px;
      margin: 10px 0;
      font-size: 12px;
      color: #5f6368;
      display: inline-block; 
    }
    .dtl .row.line .fare p {
      margin: 2px 0;
    }

    
    .dtl .row.line .tra {
      font-size: 12px;
      color: #5f6368;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .dtl .row.line .icn_tra_alt {
       font-size: 16px;
       font-weight: bold;
       color: #007bff; 
    }

    .dtl .row.line .pos {
      font-size: 12px;
      margin-top: 5px;
    }
    .dtl .lp_link {
      color: #007bff;
      text-decoration: none;
      font-size: 12px;
    }
    .dtl .lp_link:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <form id="routeContainer" style="display: block;">
    <div id="calcForm">
      <table id="headerTable">
        <tr>
          <td class="col2" colspan="3" style="vertical-align: top; padding: 5px;"> 
            <div style="margin-bottom: 10px;">
              <label for="source" style="display: block; margin-bottom: 3px; font-size: 13px; color: #5f6368;">Source Tracker:</label>
              <div style="position: relative;">
                <input type="text" id="source" placeholder="Type or select source" autocomplete="off" list="source-list" style="width: 90%; padding: 8px 10px; border: 1px solid #ccc; font-size: 14px;">
                <button type="button" id="clear-source" style="position: absolute; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 16px; color: #888;">×</button>
              </div>
              <datalist id="source-list"></datalist>
            </div>
            <div>
               <label for="target" style="display: block; margin-bottom: 3px; font-size: 13px; color: #5f6368;">Target Tracker:</label>
               <div style="position: relative;">
                 <input type="text" id="target" placeholder="Type or select target" autocomplete="off" list="target-list" style="width: 90%; padding: 8px 10px; border: 1px solid #ccc; font-size: 14px;">
                 <button type="button" id="clear-target" style="position: absolute; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 16px; color: #888;">×</button>
               </div>
               <datalist id="target-list"></datalist>
            </div>
          </td>
        </tr>
      </table>

      <div class="inline-settings-container">
        
        <div class="settings-section">
          <div class="settings-header">Route Options</div>
          <div class="settings-options">
            
            <div class="settings-option-item radio-group">
              <label>Max Jumps</label>
              <div class="radio-options">
                <label class="radio-option">
                  <input type="radio" name="maxJumps" value="1"> 1
                </label>
                <label class="radio-option">
                  <input type="radio" name="maxJumps" value="4" checked> 4
                </label>
                <label class="radio-option">
                  <input type="radio" name="maxJumps" value="9"> 9
                </label>
              </div>
            </div>

            <div class="settings-option-item radio-group">
              <label>Max Days</label>
              <div class="radio-options">
                <label class="radio-option">
                  <input type="radio" name="maxDays" value="360" checked> 360
                </label>
                <label class="radio-option">
                  <input type="radio" name="maxDays" value="720"> 720
                </label>
                <label class="radio-option">
                  <input type="radio" name="maxDays" value="1080"> 1080
                </label>
                <label class="radio-option">
                  <input type="radio" name="maxDays" value="1800"> 1800
                </label>
              </div>
            </div>
            <div class="settings-option-item radio-group">
              <label>Sort By</label>
               <div class="radio-options">
                <label class="radio-option">
                  <input type="radio" name="sortOption" value="fastest" checked> Days
                </label>
                <label class="radio-option">
                  <input type="radio" name="sortOption" value="fewestJumps"> Jumps
                </label>
              </div>
            </div>
          </div>
        </div>

      </div> 

      <div id="detailsTable"></div>
    </div>
  </form>
      <div style="position: absolute; bottom: 0.5em; right: 0.5em; font-size: 13px; text-align: right; color: rgb(0, 0, 0); text-decoration: none;">
      <p id="update-time" style="display: inline;">Last updated Loading...</p>
      <a href="https://www.reddit.com/r/TrackersInfo/wiki/official_recruitments/">TrackersInfo</a>
      <a href="https://github.com/ti-or/ti-or.github.io">GitHub</a>
    </div>
  <script>

  window.addEventListener('load', function() {
    const arrowIndicator = document.createElement('div');
    arrowIndicator.className = 'arrow-indicator';
    arrowIndicator.innerHTML = '▲<br>▼';
    document.body.appendChild(arrowIndicator);

    const validMaxDaysValues = [360, 720, 1080, 1800];
    const defaultMaxDays = 360;
    const validMaxJumpsValues = [1, 4, 9];
    const defaultMaxJumps = 4;
    const validSortOptionValues = ['fastest', 'fewestJumps'];
    const defaultSortOption = 'fastest';

    let activeRouteIndex = 0; 
    let maxJumps = defaultMaxJumps;
    console.log(`Attempting to select maxJumps radio with value: "${maxJumps}"`);

    let maxDays = defaultMaxDays;
    console.log(`Attempting to select maxDays radio with value: "${maxDays}"`);

    let sortOptionValue = defaultSortOption;
     console.log(`Attempting to select sortOption radio with value: "${sortOptionValue}"`);


    const sourceInput = document.getElementById('source');
    const targetInput = document.getElementById('target');
    const { routeInfo, unlockInviteClass, abbrList } = data;
    let allRoutes = [];

    function getLastUpdatedMonth() {
        let lastUpdated = "Loading...";
        let latestDate = new Date(0); // Initialize with a very old date
        for (const tracker in routeInfo) {
            for (const dest in routeInfo[tracker]) {
                const dateString = routeInfo[tracker][dest][2];
                if (dateString) {
                    const parts = dateString.split(' ');
                    const month = parts[0];
                    const year = parseInt(parts[1]);
                    const date = new Date(`${month} 01, ${year}`); // Create a Date object

                    if (!isNaN(date.getTime()) && date > latestDate) {
                        latestDate = date;
                        lastUpdated = `${month} ${year}`;
                    }
                }
            }
        }
        return lastUpdated;
    }
   const updateTimeElement = document.getElementById('update-time');
   updateTimeElement.textContent = `Last updated ${getLastUpdatedMonth()}`;

    function populateDatalists() {
        const sourceList = document.getElementById('source-list');
        const targetList = document.getElementById('target-list');
        sourceList.innerHTML = '';
        targetList.innerHTML = '';

      const uniqueKeys = Array.from(new Set(
        Object.keys(routeInfo)
        .flatMap(startKey => [startKey, ...Object.keys(routeInfo[startKey])])
      ))
      .sort((a, b) => a.toLowerCase().localeCompare(b.toLowerCase()));

        uniqueKeys.forEach(key => {
            const option = document.createElement('option');
            option.value = key;
            sourceList.appendChild(option.cloneNode(true));
            targetList.appendChild(option);
        });
        console.log("Datalists populated.");
    }

    function getMaxDays(start, end) {
      const days1 = (routeInfo[start] && routeInfo[start][end] && routeInfo[start][end][0]) || 0;
      const days2 = (unlockInviteClass[start] && unlockInviteClass[start][0]) || 0;
      return Math.max(days1, days2);
    }

    function findAllRoutes(start, end, maxJumps = 5, maxDays = 1080) {
      const result = [];
      const stack = [[start, [start], 0]];
      while (stack.length) {
        const [node, route, days] = stack.pop();
        if (route.length > maxJumps + 1 || days > maxDays) continue;
        if (node === end) {
          result.push(route);
          continue;
        }
        for (const [next, _] of Object.entries(routeInfo[node] || {})) {
          const maxDaysToNext = getMaxDays(node, next);
          if (!route.includes(next) && (days + maxDaysToNext) <= maxDays) {
            stack.push([next, [...route, next], days + maxDaysToNext]);
          }
        }
      }
      return result;
    }

    function showPage(routes, currentPage, activeRouteIndex) {
        const pageSize = 5;
        const startIndex = (currentPage - 1) * pageSize;
        const endIndex = Math.min(startIndex + pageSize, routes.length);
        const totalPages = Math.ceil(routes.length / pageSize);
        const resultDescription = document.getElementById('detailsTable');
        
        let routesHTML = '';
        for (let i = startIndex; i < endIndex; i++) {
            const route = routes[i];
          const totalDays = route.reduce((sum, node, index) => {
            if (index < route.length - 1 && routeInfo[node] && routeInfo[node][route[index + 1]]) {
              return sum + getMaxDays(node, route[index + 1]);
            }
            return sum;
          }, 0);
            const jumps = route.length - 1; 
            const isActiveClass = i === activeRouteIndex ? 'active' : ''; 

          routesHTML += `
            <div class="block route">
                <div class="route-header ${isActiveClass}" data-route-index="${i}"> 
                  <span class="route-number-label">Route ${i + 1}</span>
                  <span class="route-time-display">
                    <span class="route-label time-label">Days</span> ${totalDays} 
                      </span>
                  <span class="route-changes-display">
                    <span class="route-label changes-label">Jumps</span> ${jumps}</span>
                    </div>
                <div class="block_content"> 
                <div class="dtl">
          `;
          let cumulativeDays = 0;
          route.forEach((node, index) => {
            const isLast = index === route.length - 1;
            const isFirst = index === 0;
            cumulativeDays += (isFirst ? 0 : getMaxDays(route[index-1] || '', node) || 0);
            routesHTML += `
              <div class="row sta${isFirst ? ' from' : isLast ? ' to' : ''}">
                <div class="tbl">
                     <div class="col border"></div>
                  <div class="col wrapper">
                    <div class="tbl">
                      <div class="col header">
                           <div class="time">Day ${cumulativeDays}</div>
                        <div class="name">
                          <p class="lang_main">${node}${abbrList[node] ? ` (${abbrList[node]})` : ''}</p>
                        </div>
                      </div>
                         <div class="col content"></div>
                    </div>
                  </div>
                </div>
              </div>
            `;

            if (!isLast && routeInfo[node] && routeInfo[node][route[index + 1]]) {
              const nextNode = route[index + 1];
              const [time, requirement, lastActivity] = routeInfo[node][nextNode];
                 const inviteReq = unlockInviteClass[node] ? unlockInviteClass[node][1] : 'N/A';
              routesHTML += `
                <div class="row line">
                  <div class="tbl">
                    <div class="col border">
                         <div class="timeline-line full-height" style="background-color: #009BBF;"></div> 
                    </div>
                    <div class="col wrapper">
                      <div class="tbl">
                        <div class="col content">
                          <p class="tra">
                               Jump to ${nextNode}
                          </p>
                        </div>
                        <div class="col aside">${getMaxDays(node, nextNode)} days</div>
                      </div>
                         <div class="fare">
                           <p>Requirements: ${requirement || 'None'}</p>
                           <p>Class for invite forum: ${inviteReq}</p>
                           <p class="lang_sub">Last checked: ${lastActivity}</p>
                         </div>
                    </div>
                  </div>
                </div>
              `;
            }
          });
           routesHTML += `</div></div></div>`;
        }

        const paginationHTML = `
          <div class="pagination block" style="padding: 10px; text-align: center;">
            ${currentPage > 1 ? `<button class="page-btn" style="margin: 5px;" data-page="1">&lt;&lt;</button>` : ''}
            ${currentPage > 1 ? `<button class="page-btn" style="margin: 5px;" data-page="${currentPage - 1}">&lt;</button>` : ''}
            ${
              Array.from({ length: Math.min(5, totalPages) }, (_, i) => {
                let startPage = Math.max(1, currentPage - 2);
                if (startPage + 4 > totalPages) {
                  startPage = Math.max(1, totalPages - 4);
                }
                const page = startPage + i;
                return `<button class="page-btn" style="margin: 5px;" data-page="${page}">${page}</button>`;
              }).join('')
            }
            ${currentPage < totalPages ? `<button class="page-btn" style="margin: 5px;" data-page="${currentPage + 1}">&gt;</button>` : ''}
            ${currentPage < totalPages ? `<button class="page-btn" style="margin: 5px;" data-page="${totalPages}">&gt;&gt;</button>` : ''}
          </div>
        `;
        resultDescription.innerHTML = routesHTML + paginationHTML;

        resultDescription.querySelectorAll('.page-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const newPage = parseInt(e.target.dataset.page);
            if (newPage !== currentPage) {
              showPage(allRoutes, newPage, activeRouteIndex);
              window.scrollTo(0, 0);
            }
          });
        });

        resultDescription.querySelectorAll('.route-header').forEach(header => {
            header.addEventListener('click', (event) => {
                const newActiveIndex = parseInt(header.dataset.routeIndex, 10);
                if (activeRouteIndex !== newActiveIndex) {
                    activeRouteIndex = newActiveIndex;
                    document.querySelectorAll('.route-header.active').forEach(el => el.classList.remove('active'));
                    header.classList.add('active');
            }
          });
        });
      }

    function calculateRouteTotalDays(route) {
        let totalDays = 0;
        for (let i = 0; i < route.length - 1; i++) {
            totalDays += getMaxDays(route[i], route[i+1]);
        }
        return totalDays;
    }

    function calculateRoute() {
      const resultDescription = document.getElementById('detailsTable');
      resultDescription.innerHTML = ''; 

      const start = sourceInput.value.trim(); 
      const end = targetInput.value.trim(); 
      console.log(`Calculating route from "${start}" to "${end}"`);

      if (start === '' || end === '') {
          resultDescription.innerHTML = '<div class="status-message">Select From and To trackers</div>'; 
          allRoutes = [];
          const pagination = resultDescription.querySelector('.pagination');
          if (pagination) pagination.remove(); 
          return; 
      }
      if (start === end) {
        resultDescription.innerHTML = '<div class="status-message">One account per lifetime!</div>';
        allRoutes = [];
        const pagination = resultDescription.querySelector('.pagination');
        if (pagination) pagination.remove();
        return;
      }
      if (!routeInfo[start]) {
        resultDescription.innerHTML = `<div class="status-message">Tracker "${start}" not found or has no routes.</div>`;
        allRoutes = [];
         const pagination = resultDescription.querySelector('.pagination');
         if (pagination) pagination.remove();
        return;
      }
      const endExists = routeInfo[end] || Object.values(routeInfo).some(targets => targets && targets[end]);
      if (!endExists) {
           resultDescription.innerHTML = `<div class="status-message">Target tracker "${end}" not found in routes.</div>`;
           allRoutes = [];
           const pagination = resultDescription.querySelector('.pagination');
           if (pagination) pagination.remove();
           return;
      }

      allRoutes = findAllRoutes(start, end, maxJumps, maxDays);

      if (allRoutes.length === 0) {
        resultDescription.innerHTML = '<div class="status-message">No results found</div>';
        return;
      }
      
      const currentSortOption = document.querySelector('input[name="sortOption"]:checked').value;
      console.log(`Sorting by: ${currentSortOption}`); 
      
      if (currentSortOption === 'fastest') {
          allRoutes.sort((routeA, routeB) => {
              const daysA = calculateRouteTotalDays(routeA);
              const daysB = calculateRouteTotalDays(routeB);
              if (daysA !== daysB) {
                  return daysA - daysB;
              }
              return routeA.length - routeB.length; 
          });
      } else if (currentSortOption === 'fewestJumps') {
          allRoutes.sort((routeA, routeB) => {
              if (routeA.length !== routeB.length) {
                  return routeA.length - routeB.length;
              }
              const daysA = calculateRouteTotalDays(routeA);
              const daysB = calculateRouteTotalDays(routeB);
              return daysA - daysB;
          });
      }

      activeRouteIndex = 0;
      showPage(allRoutes, 1, activeRouteIndex);
    }

    try {
    } catch (e) {
        console.error("Error during initial radio state setting:", e);
    }
    
    populateDatalists();

    const savedSource = null;
    const savedTarget = null;

    document.querySelectorAll('input[name="maxJumps"]').forEach(radio => { 
        radio.addEventListener('change', (e) => {
            maxJumps = parseInt(e.target.value, 10); 
            calculateRoute();
        }); 
    });
    document.querySelectorAll('input[name="maxDays"]').forEach(radio => { 
        radio.addEventListener('change', (e) => {
            maxDays = parseInt(e.target.value, 10); 
            calculateRoute();
        }); 
    });
    document.querySelectorAll('input[name="sortOption"]').forEach(radio => { 
        radio.addEventListener('change', (e) => {
            sortOptionValue = e.target.value; 
            calculateRoute();
        }); 
    });
    
    [sourceInput, targetInput].forEach(input => {
        const inputId = input.id;

        input.addEventListener('change', () => {
            console.log(`Change detected on ${inputId}. New value: "${input.value}"`);
            calculateRoute();
        });
    });

    document.getElementById('clear-source').addEventListener('click', () => {
        sourceInput.value = '';
        calculateRoute();
    });

    document.getElementById('clear-target').addEventListener('click', () => {
        targetInput.value = '';
        calculateRoute();
    });

    calculateRoute(); 

  });
  </script>
  <script data-goatcounter="https://98et5e.goatcounter.com/count"
  async src="//gc.zgo.at/count.js"></script>
</body>
</html>
